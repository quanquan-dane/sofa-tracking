/**
 * sofa-tracking - v0.8.1 - Fri Apr 17 2015 16:23:43 GMT+0200 (CEST)
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO)
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(t,a){"use strict";t.define("sofa.tracking.BingTracker",function(t){var a={};return a.setup=function(){},a.trackEvent=function(){},a.trackTransaction=function(a){var e="//flex.msn.com/mstag/tag/"+t.siteId+"/analytics.html?dedup="+(t.dedup||"1")+"&domainId="+t.domainId+"&type="+(t.type||"1")+"&revenue="+a.totals.subtotal+"&actionid="+t.actionId,n=new Image(1,1);n.src=e},a}),t.define("sofa.tracking.GoogleAdwordsConversionTracker",function(){var t={};return t.trackConversion=function(t){var e=(t.id,t.lang,t.format,t.color,t.label,t.value,t.currency,t.remarketing,a.write);a.write=function(t){a.body.appendChild(t)},function(){var t=a.createElement("script");t.src="//www.googleadservices.com/pagead/conversion.js",t.async=!0,t.onload=function(){setTimeout(function(){a.write=e},100)},a.body.appendChild(t)}()},t}),t.define("sofa.tracking.GoogleAnalyticsTracker",function(t){var e={};return e.setup=function(){var n=e._gaq=window._gaq=window._gaq||[];n.push(["_setAccount",t.accountNumber]),n.push(["_setDomainName",t.domainName]),n.push(["_setAllowLinker",!0]);var o=a.createElement("script");o.type="text/javascript",o.async=!0,o.src=("https:"===a.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var r=a.getElementsByTagName("script")[0];r.parentNode.insertBefore(o,r)},e.trackEvent=function(t){t.category=t.category||"",t.action=t.action||"",t.label=t.label||"",t.value=t.value||"";var a=[];"pageView"===t.category?(a.push("_trackPageview"),a.push(t.label)):(a.push("_trackEvent"),a.push(t.category),a.push(t.action),a.push(t.label),t.value&&a.push(t.value)),_gaq.push(a)},e.trackTransaction=function(a){if(t.conversionId){var e="http://www.googleadservices.com/pagead/conversion/"+t.conversionId+"/?value="+a.totals.subtotal+"&label="+t.conversionLabel+"&guid=ON&script=0",n=new Image(1,1);n.src=e}_gaq.push(["_gat._anonymizeIp"]),_gaq.push(["_addTrans",a.token,location.host,a.totals.subtotal,a.totals.vat,a.totals.shipping,"","",a.billing.countryname]),a.items.forEach(function(t){_gaq.push(["_addItem",a.token,t.productId,t.name,"",t.price,t.qty])}),_gaq.push(["_trackTrans"])},e}),t.define("sofa.tracking.GoogleAnalyticsUniversalTracker",function(e){var n={};return n.setup=function(){var t="ga-disable-"+e.accountNumber;a.cookie.indexOf(t+"=true")>-1&&(window[t]=!0),function(t,a,e,n,o,r,c){t.GoogleAnalyticsObject=o,t[o]=t[o]||function(){(t[o].q=t[o].q||[]).push(arguments)},t[o].l=1*new Date,r=a.createElement(e),c=a.getElementsByTagName(e)[0],r.async=1,r.src=n,c.parentNode.insertBefore(r,c)}(window,a,"script","//www.google-analytics.com/analytics.js","ga"),ga("create",e.accountNumber,"auto"),ga("require","linkid","linkid.js"),ga("require","displayfeatures"),ga("require","ec")},n.trackEvent=function(t){ga("set","anonymizeIp",!0),t.category=t.category||"",t.action=t.action||"",t.label=t.label||"",t.value=t.value||"","pageView"===t.category?ga("send","pageview",t.label):ga("send",{hitType:"event",eventCategory:t.category,eventAction:t.action,eventLabel:t.label,eventValue:t.value})},n.trackTransaction=function(t){t.items.forEach(function(t){ga("ec:addProduct",n.decorators.transaction.addProduct(t))}),ga("ec:setAction","purchase",n.decorators.transaction.purchase(t)),ga("send","pageview",{anonymizeIp:!0})},n.decorators={transaction:{addProduct:function(t){return{id:t.sku,name:t.name,category:null,brand:null,variant:null,price:t.price,quantity:t.qty}},purchase:function(t){return{id:t.token,affiliation:null,revenue:t.totals.grandtotal,tax:t.totals.vat,shipping:t.totals.shipping,coupon:null}}}},e.decorators&&t.Util.extend(n.decorators,e.decorators),n}),t.define("sofa.tracking.TrackingService",function(a,e,n){var o={},r=o.__trackers=[];return t.observable.mixin(o),o.addTracker=function(t){t.setup&&"function"==typeof t.setup&&t.setup(),r.push(t)},o.trackEvent=function(t){o.emit("trackEvent",o,t),r.forEach(function(a){a.trackEvent&&"function"==typeof a.trackEvent&&a.trackEvent(t)})},o.trackTransaction=function(a){var c=n.get("checkoutUrl")+"summaryfin.php";e.get(c+"?token="+a+"&details=get").then(function(e){var n=t.Util.toJson(e.data);n.token=a,o.emit("trackTransaction",o,n),r.forEach(function(t){t.trackTransaction&&"function"==typeof t.trackTransaction&&t.trackTransaction(n)})})},o.trackConversion=function(t){o.emit("trackConversion",o,t),r.forEach(function(a){a.trackConversion&&"function"==typeof a.trackConversion&&a.trackConversion(t)})},o})}(sofa,document);